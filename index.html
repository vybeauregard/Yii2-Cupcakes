<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Yii2-cupcakes : Let&#39;s make some delicious cupcakes!">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Yii2-cupcakes</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/vybeauregard/Yii2-Cupcakes">View on GitHub</a>

          <h1 id="project_title">Yii2-cupcakes</h1>
          <h2 id="project_tagline">Let&#39;s make some delicious cupcakes!</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/vybeauregard/Yii2-Cupcakes/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/vybeauregard/Yii2-Cupcakes/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><em>Before you get started, you'll probably want to <a href="https://github.com/vybeauregard/Yii2-Cupcakes/wiki">get your environment configured</a>.</em></p>

<p><em>config.php</em> holds configuration values for every part of your app.</p>

<ul>
<li>error handling</li>
<li>caching directives</li>
<li>database config</li>
<li>time zone settings</li>
<li>url management</li>
</ul>

<p>The database in the project has been configured to create an SQLite data store in the <code>db</code> directory.</p>

<h2>
<a id="file-structure" class="anchor" href="#file-structure" aria-hidden="true"><span class="octicon octicon-link"></span></a>File structure</h2>

<blockquote>
<p><em>or, "<a href="http://youtu.be/THWCH2Nwsss">Keeping the Varmints Out</a>"</em></p>
</blockquote>

<p>One large concern for any framework is keeping code organized. This fosters a collaborative environment because it makes it easier to deduce where a particular function is being called from. With Yii2, there are a lot of files that need to be accessible to the server, but not accessible from a web browser (e.g. controllers, db config, vendor files). That's where our <code>web</code> folder comes in handy. We will tell the web server that the root of the site is located at <code>web</code> and php will still be able to access all of the other files in our project without exposing them to the world.</p>

<h2>
<a id="controllers" class="anchor" href="#controllers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Controllers</h2>

<blockquote>
<p><em><a href="http://youtu.be/mk74WprmZxY#t=12">Where do you think <strong>you're</strong> going?</a></em></p>
</blockquote>

<p>Controllers direct traffic between the browser and the data. Yii2 knows that when a user requests the page at <code>cupcakes/list</code> to talk to the cupcakes controller and find out what it says to do with <code>actionList()</code>. From the context provided by the verb list, we can deduct that this route will produce a list of all the cupcakes that are available.</p>

<p><em>controllers/cupcakes.php</em></p>

<div class="highlight highlight-php"><pre><span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">app\controllers</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">Yii</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">app\models\Cupcake</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">yii\web\NotFoundHttpException</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">CupcakeController</span> <span class="pl-k">extends</span> <span class="pl-e">Controller</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">  <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">actionList</span>(){</span>
<span class="pl-s1">    <span class="pl-smi">$model</span> <span class="pl-k">=</span> <span class="pl-c1">Cupcake</span><span class="pl-k">::</span>find();</span>
<span class="pl-s1">    <span class="pl-k">if</span>(<span class="pl-smi">$model</span> <span class="pl-k">===</span> <span class="pl-c1">null</span>){</span>
<span class="pl-s1">      <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-c1">NotFoundHttpException</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>render(<span class="pl-s"><span class="pl-pds">'</span>list<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s1">      <span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$model</span>;</span>
<span class="pl-s1">    ]);</span>
<span class="pl-s1">  }</span>
<span class="pl-s1">}</span></pre></div>

<p>Cupcakes! Here's the simple data structure we'll be working with:</p>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>description</th>
<th>cake_flavor_1</th>
<th>cake_flavor_2</th>
<th>cake_color</th>
<th>icing_flavor</th>
<th>icing_color</th>
<th>fondant</th>
<th>calories</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Marble</td>
<td>Marble</td>
<td>Chocolate</td>
<td>Vanilla</td>
<td>Marble</td>
<td>Butter Cream</td>
<td>Ivory</td>
<td>No</td>
<td>220</td>
</tr>
<tr>
<td>2</td>
<td>Pumpkin Mania</td>
<td>It looks and tastes like a whole pumpkin!</td>
<td>Pumpkin</td>
<td>null</td>
<td>Orange</td>
<td>Cream Cheese</td>
<td>White</td>
<td>No</td>
<td>190</td>
</tr>
<tr>
<td>3</td>
<td>Power Up!</td>
<td>Mushrooms inspired by Super Mario Bros.</td>
<td>Carrot Cake</td>
<td>null</td>
<td>Brown</td>
<td>Cream Cheese</td>
<td>White</td>
<td>Yes</td>
<td>245</td>
</tr>
</tbody>
</table>

<p>Before we wire up a model and view to the <code>controllers/cupcakes.php</code>, let's create our table using Yii's migration feature.</p>

<h2>
<a id="migrations" class="anchor" href="#migrations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Migrations</h2>

<blockquote>
<p><em><a href="http://youtu.be/w8Rn_f75UHs#t=80">Are you suggesting coconuts migrate?</a></em></p>
</blockquote>

<p>To initialize a new migration, navigate to your project in the command line and execute <code>./yii migrate/create create_cupcakes_table</code>. This will create a new migration file <code>m150610_160800_create_cupcakes_table.php</code> with today's date and time in the file name. Inside the migration class are two methods: <code>up()</code> and <code>down()</code>. When rolling back migrations, <code>down</code> will be executed. When applying a migration, <code>up</code> is executed.
If you're using a transactional database engine, <code>safeUp()</code> and <code>safeDown()</code> will do the same, but in a transaction-safe manner.
Since we're just creating a table to hold some cupcakes, we'll just add the <code>createTable()</code> information to <code>up()</code> and the <code>dropTable()</code> command to <code>down()</code>.</p>

<div class="highlight highlight-php"><pre><span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">up</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">      <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>createTable(<span class="pl-s"><span class="pl-pds">'</span>cupcakes<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_PK</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>cake_flavor_1<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>cake_flavor_2<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>cake_color<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>icing_flavor<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>icing_color<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>fondant<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_STRING</span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>calories<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Schema</span><span class="pl-k">::</span><span class="pl-c1">TYPE_INTEGER</span>,</span>
<span class="pl-s1">      ]);</span>
<span class="pl-s1">      <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>batchInsert(<span class="pl-s"><span class="pl-pds">'</span>sites<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>cake_flavor_1<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>cake_flavor_2<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>cake_color<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>icing_flavor<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>icing_color<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>fondant<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>calories<span class="pl-pds">'</span></span>], [</span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>Marble<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Marble<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Chocolate<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Vanilla<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Marble<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Butter Cream<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Ivory<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>No<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>220<span class="pl-pds">'</span></span>],</span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>Pumpkin Mania<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>It looks and tastes like a whole pumpkin!<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Pumpkin<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>null<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Orange<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Cream Cheese<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>White<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>No<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>190<span class="pl-pds">'</span></span>],</span>
<span class="pl-s1">        [<span class="pl-s"><span class="pl-pds">'</span>Power Up!<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Mushrooms inspired by Super Mario Bros.<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Carrot Cake<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>null<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Brown<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Cream Cheese<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>White<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Yes<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>245<span class="pl-pds">'</span></span>],</span>
<span class="pl-s1">      ]);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">down</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">      <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>dropTable(<span class="pl-s"><span class="pl-pds">'</span>cupcakes<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    }</span></pre></div>

<p>The <code>Schema::TYPE_</code> constants allow Yii to remain database-engine agnostic if you need to switch from, for example, POSTGRES to SQLite in midstream. As the migration is being applied, it will pull the site configuration and determine the data types for the database you're using. <a href="http://www.yiiframework.com/doc-2.0/yii-db-schema.html#constants">Here's a list of available constants</a>.</p>

<p><code>batchInsert()</code> allows us to pre-populate the table with data as the table is created. This is helpful if you know ahead of time what data records will be required in the table. <a href="http://www.yiiframework.com/doc-2.0/yii-db-migration.html#batchInsert()-detail">Here are the Yii2 docs on <code>batchInsert()</code></a>.</p>

<p>Once the migration file is saved, return to the command line and execute <code>./yii migrate/up</code>. You will be prompted to confirm the alteration, then the cupcakes table will be created.</p>

<h2>
<a id="models" class="anchor" href="#models" aria-hidden="true"><span class="octicon octicon-link"></span></a>Models</h2>

<blockquote>
<p><em><a href="http://youtu.be/YFmsgHfuXpA#t=56">Do a little turn on the catwalk</a></em></p>
</blockquote>

<p>Models are fairly straightforward. They tell Yii how our cupcake object is structured and where to find the data when we ask for it. In most cases, we can use Gii to automatically generate a model based off of the table structure in the database. This model can be altered and updated after it is generated, but Gii makes sure everything in the table makes it across to the model.</p>

<p><em>Gii can be accessed in dev environments at</em> http://your-dev-url/gii/</p>

<p>Of particular note in the cupcake model Gii generates is the <code>rules()</code> method, which allows you to set validation parameters for each field. Also, if your table uses field names that aren't super-great for human-readability, you can map them to better descriptors in the <code>attributeLabels()</code> method.</p>

<p>Now that we have a Cupcake model and a Cupcake controller, it's time to make a Cupcake view!</p>

<h2>
<a id="views" class="anchor" href="#views" aria-hidden="true"><span class="octicon octicon-link"></span></a>Views</h2>

<blockquote>
<p><em><a href="http://youtu.be/DrbPAt1_vc4#t=40">I just adore a penthouse view</a></em></p>
</blockquote>

<p>You'll notice in our Controller, the action we created was called <code>actionList</code>. </p>

<div class="highlight highlight-php"><pre><span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>render(<span class="pl-s"><span class="pl-pds">'</span>list<span class="pl-pds">'</span></span>, [</span>
<span class="pl-s1">      <span class="pl-s"><span class="pl-pds">'</span>model<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$model</span>;</span>
<span class="pl-s1">    ]);</span></pre></div>

<p>So we need to create a view called <code>list.php</code> in our <code>views/cupcakes</code> directory. By default, this is where Yii looks for the view associated with the controller handling our request.</p>

<p><em>list.php</em></p>

<div class="highlight highlight-php"><pre><span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">yii\grid\GridView</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">yii\data\ActiveDataProvider</span>;</span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">app\models\Cupcakes</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/* @var $this yii\web\View */</span></span>
<span class="pl-s1"><span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Available Cupcakes<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">params</span>[<span class="pl-s"><span class="pl-pds">'</span>breadcrumbs<span class="pl-pds">'</span></span>][] <span class="pl-k">=</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">title</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$dataProvider</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ActiveDataProvider</span>([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>query<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">Cupcakes</span><span class="pl-k">::</span>find(),</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>pagination<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>pageSize<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">20</span>,</span>
<span class="pl-s1">    ],</span>
<span class="pl-s1">]);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c1">echo</span> <span class="pl-c1">GridView</span><span class="pl-k">::</span>widget([</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>dataProvider<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-smi">$dataProvider</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>showHeader<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">true</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>showFooter<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">false</span>,</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>columns<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>cake_flavor_1<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>cake_flavor_2<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>cake_color<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>icing_flavor<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>icing_color<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>fondant<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        [</span>
<span class="pl-s1">          <span class="pl-s"><span class="pl-pds">'</span>attribute<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>calories<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">          <span class="pl-s"><span class="pl-pds">'</span>format<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>integer<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ],</span>
<span class="pl-s1">    ],</span>
<span class="pl-s1">  ]);</span></pre></div>

<p><a href="http://www.yiiframework.com/doc-2.0/yii-grid-gridview.html">GridView</a> is a handy Yii widget that will render a lovely grid with all of your cupcakes neatly aligned and sortable by any column the user desires!</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Yii2-cupcakes maintained by <a href="https://github.com/vybeauregard">vybeauregard</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
